webpackJsonp([13],{MKhv:function(e,t){},"oqV+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,l=a("mvHQ"),s=a.n(l),o=a("pFYg"),n=a.n(o),r={name:"menuManage",components:{clickButtonAdd:function(){return a.e(24).then(a.bind(null,"z8Mq"))},clickButtonRevise:function(){return a.e(23).then(a.bind(null,"rPbI"))}},data:function(){return{search:{},menuTree:[],defaultProps:{children:"child",label:"menuName"},tableData:[],tableDataAll:[],total:0,tableH:0,pageSize:20,menuParentId:"00000000-0000-0000-0000-000000000000",listLi:{menuCode:{label:"菜单编码：",type:"input",model:""},menuName:{label:"菜单名称：",type:"input",model:""},menuEnName:{label:"菜单英文名称：",type:"input",model:""},menuIcon:{label:"菜单图标：",type:"input",model:""},menuType:{label:"菜单类型：",type:"dropDown",model:0,children:["单页面","选项卡"]},menuIsHomePage:{label:"是否首页：",type:"dropDown",model:0,children:["否","是"]},sortNum:{label:"排序码：",type:"inputNumber",model:""},memo:{label:"备注：",type:"textarea",model:""}},modelListLi:{moduleName:{label:"模块名称：",type:"input",model:""},moduleUniqeCode:{label:"唯一编码：",type:"input",model:""},moduleEnName:{label:"英文模块名称：",type:"input",model:""},moduleIcon:{label:"模块图标：",type:"input",model:""},moduleVersion:{label:"模块版本：",type:"input",model:""},moduleEntrance:{label:"模块入口：",type:"input",model:""},moduleDscr:{label:"模块描述：",type:"input",model:""},sortNum:{label:"排序码：",type:"inputNumber",model:""},memo:{label:"备注：",type:"textarea",model:""}},curNode:{},title:"",addTitle:"菜单添加",reviseTitle:"修改菜单",rules:{},formLabelWidth:"120px",deleteWarning:"确定要删除此条记录？",deleteUrl:"",deleteMsg:"请选择一条记录！",deleteInfo:{},searchUrl:"",addDialog:{addDialog:!1},reviseDialog:{reviseDialog:!1},addModelTitle:"模块添加",rulesModel:{},reveseModelTitle:"修改模块",modelInfo:{},addModelDialog:{addDialog:!1},reviseModelDialog:{reviseDialog:!1}}},created:function(){var e=this,t=this;a.e(22).then(a.bind(null,"sp+l")).then(function(a){(i=new a.default.ParentFn).error=e.$t("error"),i.success=e.$t("success"),i.button=e.$t("button"),i.message=e.$t("message"),t.listLi=e.$t("menuManage.listLi"),t.modelListLi=e.$t("menuManage.modelListLi"),e.rules={menuCode:[{validator:i.noIsEmpty(e.$t("menuManage.menuRules.menuCode")),required:!0,trigger:"blur"}],menuName:[{validator:i.noIsEmpty(e.$t("menuManage.menuRules.menuName")),required:!0,trigger:"blur"}]},e.rulesModel={moduleName:[{validator:i.noIsEmpty(e.$t("menuManage.modelRules.moduleName")),required:!0,trigger:"blur"}],moduleUniqeCode:[{validator:i.noIsEmpty(e.$t("menuManage.modelRules.moduleUniqeCode")),required:!0,trigger:"blur"}],moduleEntrance:[{validator:i.noIsEmpty(e.$t("menuManage.modelRules.moduleEntrance")),required:!0,trigger:"blur"}]},i.ajax("api/services/app/SmMenu/QueryAll",{id:t.menuParentId},t,function(e){if(e.success){var a=e.result.items;console.log(a,void 0===a?"undefined":n()(a)),e.success&&a.length>0&&(t.menuTree=a,t.menuParentId=a[0].id,t.$nextTick(function(){t.$refs.menuTree.setCurrentKey(a[0].id),t.curNode=a[0],t.getModel(a[0].id)}))}})})},mounted:function(){var e=this.$refs.tableBox.offsetHeight,t=this.$refs.pagination.offsetHeight;this.tableH=e-t},methods:{expandNode:function(){},nodeExpand:function(e,t,a){e.opend=!e.opend},nodeCollapse:function(e,t,a){e.opend=!e.opend},changeChecked:function(){},handleNodeSideClick:function(){},changeCurPage:function(e){},clickNode:function(e,t,a){this.curNode=e;var i=e.id;this.getModel(i)},getModel:function(e){var t=this;i.ajax("api/services/app/SmModule/GetByMenuID?menuId="+e,"",this,function(e){if(e.success)for(var a in t.tableData=e.result.items,t.total=t.tableData.length,t.tableDataAll=[],t.tableData)t.tableData[a].checked=!1,t.tableDataAll.push(t.tableData[a])},"GET")},testNameIsRepeat:function(e,t){for(var a in i.boole=!1,e)if(e[a].menuName==t){i.boole=!0;break}},testTreeName:function(e,t,a){for(var l in e)e[l].id==a?e[l].child&&e[l].child.length>0?this.testNameIsRepeat(e[l].child,t):i.boole=!1:e[l].child&&e[l].child.length&&this.testTreeName(e[l].child,t,a)},testReviseNameIsRepeat:function(e,t,a){for(var l in i.boole=!1,e)if(e[l].menuName==t&&e[l].id!=a){i.boole=!0;break}},testReiveseTreeName:function(e,t,a){for(var i in e)e[i].id==a?this.testReviseNameIsRepeat(e,t,a):e[i].child&&e[i].child.length>0&&this.testReiveseTreeName(e[i].child,t,a)},reviseMenuTree:function(e,t,a){for(var i in e)if(e[i].id==t)for(var l in e[i])"child"!=l&&(e[i][l]=a[l]);else e[i].child&&e[i].child.length&&this.reviseMenuTree(e[i].child,t,a);return e},nodeIsChild:function(e,t){for(var a in i.boole=!1,e)if(e[a].id==t){if(e[a].child&&e[a].child.length)return void(i.boole=!0)}else e[a].child&&e[a].child.length&&this.nodeIsChild(e[a].child,t)},menuAddInfoCancel:function(){this.addDialog.addDialog=!1},menuClickAddInfo:function(){this.tableData.length>0?this.$message.error(i.error.menuNextModel):this.addDialog.addDialog=!0},addConfirm:function(e){var t=this;if(this.testTreeName(this.menuTree,this.listLi.menuName.model,this.curNode.id),i.boole)this.$message.error(i.error.nameRepeat);else{var a={};for(var l in e)a[l]=e[l].model;a.menuParentId=this.curNode.id,i.ajax("api/services/app/SmMenu/Create",a,this,function(e){if(e.success){for(var l in t.$message({message:i.success.add,type:"success"}),t.addDialog.addDialog=!1,t.listLi)"dropDown"==t.listLi[l].type?t.listLi[l].model=0:t.listLi[l].model="";t.$refs.menuTree.append(e.result,a.menuParentId)}else t.addDialog.addDialog=!0})}},reviseMenuInfo:function(){if(this.curNode.id!=this.menuParentId){for(var e in this.listLi)this.listLi[e].model=this.curNode[e];var t=this.listLi.menuType.model;this.listLi.menuType.model=parseInt(t),this.listLi.menuIsHomePage.model=parseInt(this.listLi.menuIsHomePage.model),this.reviseDialog.reviseDialog=!0}else this.$message.error(i.error.menuRoot)},reviseConfirm:function(e){var t=this;if(this.testReiveseTreeName(this.menuTree,this.listLi.menuName.model,this.curNode.id),console.log(i.boole),i.boole)this.$message.error(i.error.nameRepeat);else{var a={},l=this;for(var o in e)a[o]=e[o].model;a.menuParentId=this.curNode.menuParentId,a.id=this.curNode.id,i.ajax("api/services/app/SmMenu/Update",a,this,function(e){if(e.success){var o=JSON.parse(s()(l.menuTree));for(var n in l.menuTree=l.reviseMenuTree(o,a.id,e.result),l.$message({message:i.success.revise,type:"success"}),t.reviseDialog.reviseDialog=!1,t.curNode=e.result,t.listLi)"dropDown"==t.listLi[n].type?t.listLi[n].model=0:t.listLi[n].model="";t.$nextTick(function(){l.$refs.menuTree.setCurrentKey(e.result.id)})}else t.reviseDialog.reviseDialog=!0},"put")}},reviseMenuCancel:function(){this.reviseDialog.reviseDialog=!1},clickDelete:function(){var e=this.curNode.id;if(this.menuParentId!=e){var t=this;this.nodeIsChild(this.menuTree,e),console.log(i.boole),i.boole?this.$message.error(i.error.menuNode):this.tableData.length>0?this.$message.error(i.error.menuNextModel):this.$confirm(i.message.delete,i.message.title,{confirmButtonText:i.button.confirm,cancelButtonText:i.button.cancel,type:"warning"}).then(function(){i.ajax("api/services/app/SmMenu/Delete?id="+e,"",t,function(a){a.success&&(t.$refs.menuTree.remove(e),t.$message({type:"success",message:i.success.delete}),t.curNode=t.menuTree[0],t.$refs.menuTree.setCurrentKey(t.curNode.id))},"DELETE")}).catch(function(){})}else this.$message.error(i.error.menuRoot)},modelAddInfoCancel:function(){this.addModelDialog.addDialog=!1},modelClickAddInfo:function(){this.curNode.id!=this.menuParentId&&(this.nodeIsChild(this.menuTree,this.curNode.id),i.boole?this.$message.error(i.error.menuNode):this.addModelDialog.addDialog=!0)},addModelConfirm:function(e){var t={},a=this;for(var l in e)t[l]=e[l].model;t.menuId=this.curNode.id,i.ajax("api/services/app/SmModule/Create",t,this,function(e){e.success?(a.addModelDialog.addDialog=!1,a.$message({message:i.success.add,type:"success"}),a.tableDataAll.push(e.result),a.search.modelName||a.search.modelNum?a.query():a.tableData.push(e.result),a.total=a.tableData.length):a.addModelDialog.addDialog=!0})},reviseModelInfo:function(){var e=0;for(var t in this.tableData)this.tableData[t].checked&&(this.modelInfo=this.tableData[t],this.tableData[t].id,e++);if(1==e){for(var a in this.modelListLi)this.modelListLi[a].model=this.modelInfo[a];this.reviseModelDialog.reviseDialog=!0}else this.$message.error(i.error.noData)},reviseModelCancel:function(){this.reviseModelDialog.reviseDialog=!1},reviseModelConfirm:function(e){var t={},a=this,l=this.modelInfo;for(var s in e)t[s]=e[s].model;t.menuId=this.curNode.id,t.id=l.id,t.dataFlag=l.dataFlag?l.dataFlag:"",console.log(t),i.ajax("api/services/app/SmModule/Update",t,this,function(e){if(e.success){for(var t in a.tableData)a.tableData[t].id==l.id&&a.tableData.splice(t,1,e.result);for(var t in a.tableDataAll)l.id==a.tableDataAll[t].id&&a.tableDataAll.splice(t,1,e.result);for(var s in a.modelInfo=e.result,a.reviseModelDialog.reviseDialog=!1,a.modelListLi)"dropDown"==a.modelListLi[s].type?a.modelListLi[s].model=0:a.modelListLi[s].model="";a.$message({message:i.success.revise,type:"success"})}else a.reviseModelDialog.reviseDialog=!0},"put")},select:function(e,t){for(var a in this.modelInfo=t,this.tableData)if(this.tableData[a].id==t.id){this.tableData[a].checked=!this.tableData[a].checked,this.tableData[a].checked?this.$refs.table.setCurrentRow(t):this.$refs.table.setCurrentRow();break}},rowClick:function(e,t,a){for(var i in this.tableData)if(this.tableData[i].id==e.id){this.tableData[i].checked=!this.tableData[i].checked,this.$refs.table.toggleRowSelection(e,this.tableData[i].checked),this.tableData[i].checked?this.$refs.table.setCurrentRow(e):this.$refs.table.setCurrentRow();break}},selectAll:function(e){if(e.length>0)for(var t in this.tableData)this.tableData[t].checked=!0;else for(var t in this.tableData)this.tableData[t].checked=!1},clickModelDelete:function(){var e=this,t=this,a=[];for(var l in this.tableData)this.tableData[l].checked&&a.push(this.tableData[l].id);a.length>0?this.$confirm(i.message.delete,i.message.title,{confirmButtonText:i.button.confirm,cancelButtonText:i.button.cancel,type:"warning"}).then(function(){i.ajax("api/services/app/SmModule/DeleteMore?input="+a.join(","),"",e,function(e){if(e.success){for(var l=0;l<a.length;l++){for(var s=0;s<t.tableDataAll.length;s++)a[l]==t.tableDataAll[s].id&&(t.tableDataAll.splice(s,1),s--);for(s=0;s<t.tableData.length;s++)a[l]==t.tableData[s].id&&(t.tableData.splice(s,1),s--)}t.modelInfo={},t.total=t.tableData.length,t.$message({type:"success",message:i.success.delete})}},"DELETE")}).catch(function(){}):this.$message.error(i.error.noData)},query:function(){var e=this.search.modelNum,t=this.search.modelName;if(e||t){this.tableData=JSON.parse(s()(this.tableDataAll));for(var a=0;a<this.tableData.length;a++)e&&t?-1!=this.tableData[a].moduleName.indexOf(t)&&-1!=this.tableData[a].moduleUniqeCode.indexOf(e)||(this.tableData.splice(a,1),a--):e&&!t?-1==this.tableData[a].moduleUniqeCode.indexOf(e)&&(this.tableData.splice(a,1),a--):!e&&t&&(console.log(this.tableData[a].moduleName.indexOf(t)),-1==this.tableData[a].moduleName.indexOf(t)&&(this.tableData.splice(a,1),a--))}else this.tableData=JSON.parse(s()(this.tableDataAll))}},store:a("olkN").a,watch:{}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"tree-aside"},[a("div",{staticClass:"current"},[e._v(e._s(e.$t("menuManage.curMenuTitle")))]),e._v(" "),a("el-row",{staticClass:"row row-center"},[a("click-button-add",{staticClass:"button",attrs:{listLi:e.listLi,title:e.$t("menuManage.addTitle"),rules:e.rules,formLabelWidth:e.formLabelWidth,addDialog:e.addDialog},on:{addConfirm:e.addConfirm,addInfoCancel:e.menuAddInfoCancel,clickAddInfo:e.menuClickAddInfo}}),e._v(" "),a("click-button-revise",{staticClass:"button",attrs:{formLabelWidth:e.formLabelWidth,listLi:e.listLi,title:e.$t("menuManage.reviseTitle"),rules:e.rules,info:e.curNode,reviseDialog:e.reviseDialog,menuParentId:e.menuParentId},on:{reviseInfoCancel:e.reviseMenuCancel,reviseConfirm:e.reviseConfirm,clickReviseInfo:e.reviseMenuInfo}}),e._v(" "),a("el-button",{staticClass:"button",attrs:{type:"primary",size:"small",icon:"el-icon-close"},on:{click:e.clickDelete}},[e._v(e._s(e.$t("button.delete")))])],1),e._v(" "),a("el-aside",{staticClass:"el-aside",attrs:{width:"250"}},[a("el-tree",{ref:"menuTree",staticClass:"border-blue",attrs:{"expand-on-click-node":!1,"empty-text":"","default-expand-all":"",data:e.menuTree,"node-key":"id","highlight-current":"",props:e.defaultProps},on:{"node-expand":e.nodeExpand,"node-collapse":e.nodeCollapse,"node-click":e.clickNode},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,l=t.data;return a("span",{staticClass:"custom-tree-node"},[void 0==l.child||0==l.child.length?a("span",{staticClass:"icon iconfont",staticStyle:{color:"#00a8d4","font-size":"14px"}},[e._v("")]):e._e(),e._v(" "),void 0!=l.child&&0!=l.child.length?a("span",{staticClass:"icon iconfont",staticStyle:{color:"#00a8d4","font-size":"12px"}},[e._v("")]):e._e(),e._v(" "),"node"!=l.type||l.opend?e._e():a("span",{staticClass:"icon iconfont",staticStyle:{color:"#00a8d4","font-size":"14px"}},[e._v("")]),e._v(" "),a("span",[e._v(e._s(i.label))])])}}])})],1)],1),e._v(" "),a("el-container",{staticClass:"content"},[a("div",{staticClass:"current"},[e._v(e._s(e.$t("menuManage.curModelTitle")))]),e._v(" "),a("el-row",{staticClass:"row"},[a("click-button-add",{staticClass:"button",attrs:{menuId:e.curNode.id,menuParentId:e.menuParentId,listLi:e.modelListLi,title:e.$t("menuManage.addModelTitle"),rules:e.rulesModel,formLabelWidth:e.formLabelWidth,addDialog:e.addModelDialog},on:{addConfirm:e.addModelConfirm,addInfoCancel:e.modelAddInfoCancel,clickAddInfo:e.modelClickAddInfo}}),e._v(" "),a("click-button-revise",{staticClass:"button",attrs:{listLi:e.modelListLi,title:e.$t("menuManage.reviseModelTitle"),rules:e.rulesModel,reviseDialog:e.reviseModelDialog,formLabelWidth:e.formLabelWidth},on:{reviseInfoCancel:e.reviseModelCancel,reviseConfirm:e.reviseModelConfirm,clickReviseInfo:e.reviseModelInfo}}),e._v(" "),a("el-button",{staticClass:"button",attrs:{type:"primary",size:"small",icon:"el-icon-close"},on:{click:e.clickModelDelete}},[e._v(e._s(e.$t("button.delete")))]),e._v(" "),a("el-row",{staticClass:"model-input"},[a("span",{staticClass:"name"},[e._v(e._s(e.$t("menuManage.modelListLi.moduleUniqeCode.label")))]),e._v(" "),a("el-input",{staticClass:"input",attrs:{size:"small"},model:{value:e.search.modelNum,callback:function(t){e.$set(e.search,"modelNum",t)},expression:"search.modelNum"}})],1),e._v(" "),a("el-row",{staticClass:"model-input"},[a("span",{staticClass:"name"},[e._v(e._s(e.$t("menuManage.modelListLi.moduleName.label")))]),e._v(" "),a("el-input",{staticClass:"input",attrs:{size:"small"},model:{value:e.search.modelName,callback:function(t){e.$set(e.search,"modelName",t)},expression:"search.modelName"}})],1),e._v(" "),a("el-button",{staticClass:"button",attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:e.query}},[e._v(e._s(e.$t("button.search")))])],1),e._v(" "),a("div",{ref:"tableBox",staticClass:"table-box"},[a("el-table",{ref:"table",staticClass:"center",staticStyle:{"text-align":"center",width:"100%"},attrs:{data:e.tableData,height:e.tableH,size:"mini"},on:{select:e.select,"select-all":e.selectAll,"row-click":e.rowClick}},[a("el-table-column",{attrs:{width:"100",type:"selection",height:"40px"}}),e._v(" "),e._l(e.$t("menuManage.tableTitle"),function(e,t){return a("el-table-column",{key:t,attrs:{prop:e.prop,width:e.width,label:e.label}})})],2),e._v(" "),a("div",{ref:"pagination",staticClass:"block"},[a("el-pagination",{staticClass:"pagination",attrs:{"page-size":e.pageSize,layout:"prev, pager, next",total:e.total},on:{"current-change":e.changeCurPage}})],1)],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,d,!1,function(e){a("MKhv")},"data-v-6605eca8",null);t.default=c.exports}});
//# sourceMappingURL=13.0d14e42b82b0cd3db15a.js.map